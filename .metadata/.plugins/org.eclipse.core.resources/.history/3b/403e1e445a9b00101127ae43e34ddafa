#include "stm32f4xx.h"
#include <stdint.h>
#include <stdio.h>
#include "uart.h"

#define GPIOAEN			(1U<<0)
#define GPIOA_5			(1U<<5)

#define LED_PIN			GPIOA_5


char key;

int main(void) {

	char message[31] = "Hello from STM32 DMA transfer\n\r";

	// Enable clock access to LED
	RCC->AHB1ENR |= GPIOAEN;

	// set LED as output pin
	GPIOA->MODER |= (1U<<10);
	GPIOA->MODER &= ~(1U<<11);

	uart2_tx_init();
	dma1_stream6_init((uint32_t) message, (uint32_t) USART2->DR, 31);

	while (1) {}


}

static void uart_callback(void) {

	if (key == '1') {
			GPIOA->ODR |= LED_PIN;
		} else {
			GPIOA->ODR &= ~LED_PIN;
		}
}



void (USART2_IRQHandler)(void) {

	// check if RXNE is set
	if (USART2->SR & SR_RXNE) {
		uart_callback();
	}
}





